# 学生功能说明

## 功能概述

学生模块提供完整的课程管理、作业提交和成绩查询功能。

## 功能清单

### 1. 学生仪表板 (`/student_dashboard`)
**功能描述：**
- 显示学生基本信息（学号、姓名、班级、专业）
- 展示所有选修课程的卡片列表
- 每门课程显示：课程名、班级名、学期、学分、教室、上课时间
- 统计待提交作业数量
- 显示最终成绩（如已发布）
- 提供快速进入课程和查看成绩的按钮

**访问路径：** `/student_dashboard`

**权限要求：** 登录用户且角色为 `student`

---

### 2. 课程详情页 (`/student/class/<class_id>`)
**功能描述：**
- 显示课程基本信息（课程代码、学分、学期、教室、上课时间）
- 显示最终成绩（如已发布）
- 列出所有作业和考试，包括：
  - 类型（作业/考试）
  - 标题、总分、截止时间
  - 提交状态（未提交/已提交/已批改）
  - 得分（如已批改）
  - 提供提交/重新提交按钮
- 展示教学资料列表（支持下载，功能待完善）

**访问路径：** `/student/class/<class_id>`

**权限验证：** 验证学生是否选修该课程

---

### 3. 作业提交页 (`/student/assignment/<assignment_id>/submit`)
**功能描述：**
- 显示作业/考试详细信息（标题、总分、截止时间、说明）
- 提供内容输入框（多行文本域）
- 支持文件上传（功能框架已实现，待完善）
- 显示截止时间提醒：
  - 已截止：红色警告框
  - 不足24小时：黄色提醒框
- 如已提交，显示原提交记录：
  - 提交时间、状态
  - 得分和教师反馈（如已批改）
- 重新提交会覆盖原内容

**访问路径：** `/student/assignment/<assignment_id>/submit`

**表单字段：**
- `content`（必填）：作业内容
- `file`（可选）：上传文件

**权限验证：** 验证学生是否选修该课程

---

### 4. 成绩详情页 (`/student/class/<class_id>/grades`)
**功能描述：**
- 显示课程基本信息
- 展示最终成绩：
  - 大号数字显示分数
  - 成绩等级（A/B/C/D/F）
  - 成绩组成：作业平均分、考试平均分、教师评价
- 显示成绩计算公式：
  - 最终成绩 = 作业平均分 × 40% + 考试平均分 × 40% + 教师评价 × 20%
- 作业成绩明细表：
  - 列出所有作业的提交时间、得分、教师反馈
  - 显示作业平均分
- 考试成绩明细表：
  - 列出所有考试的提交时间、得分、教师反馈
  - 显示考试平均分

**访问路径：** `/student/class/<class_id>/grades`

**权限验证：** 验证学生是否选修该课程

---

## 数据库关联

### 涉及的表
- `Users` - 用户基本信息
- `Student` - 学生详细信息
- `Course` - 课程信息
- `TeachingClass` - 教学班信息
- `StudentClass` - 学生选课记录
- `Assignment` - 作业/考试信息
- `Submission` - 学生提交记录
- `Grade` - 成绩记录
- `Material` - 教学资料

### 关键查询逻辑

#### 1. 获取学生选课列表
```python
enrollments = StudentClass.query.filter_by(student_id=student.student_id).all()
```

#### 2. 统计待提交作业
```python
assignments = Assignment.query.filter_by(class_id=class_id, status=1).all()
for assignment in assignments:
    submission = Submission.query.filter_by(
        assignment_id=assignment.assignment_id,
        student_id=student.student_id
    ).first()
    if not submission:
        pending_count += 1
```

#### 3. 获取作业成绩明细
```python
homework_submissions = db.session.query(Submission, Assignment).join(Assignment).filter(
    Assignment.class_id == class_id,
    Assignment.type == 'homework',
    Submission.student_id == student.student_id
).order_by(Assignment.publish_time.desc()).all()
```

---

## 界面设计特点

### 1. 响应式卡片布局
- 使用CSS Grid实现课程卡片的自适应布局
- 每张卡片包含完整的课程信息和快捷操作按钮

### 2. 状态可视化
- 待提交作业：黄色标记
- 已提交：黄色字体
- 已批改：绿色字体
- 截止时间：红色/黄色警告

### 3. 成绩展示
- 渐变色背景的成绩汇总卡
- 颜色编码：优秀（绿色）、良好（蓝色）、不及格（红色）
- 大号字体突出显示最终成绩

### 4. 用户体验优化
- 空状态提示（无课程、无作业、无资料）
- 截止时间提醒（已截止、即将截止）
- 重新提交时显示原内容
- Flash消息提示操作结果

---

## 使用流程示例

### 学生完整使用流程

1. **登录系统**
   - 使用学生账号登录

2. **查看课程**
   - 进入学生仪表板
   - 查看所有选修课程
   - 查看待提交作业数量和当前成绩

3. **进入课程**
   - 点击"进入课程"按钮
   - 查看课程的所有作业、考试和资料

4. **提交作业**
   - 点击"提交"按钮
   - 填写作业内容
   - （可选）上传文件
   - 提交

5. **查看成绩**
   - 从仪表板或课程详情页点击"查看成绩"
   - 查看最终成绩和成绩组成
   - 查看每次作业和考试的详细得分
   - 查看教师反馈

---

## 待完善功能

### 1. 文件上传与下载
- 作业提交的文件上传功能
- 教学资料的文件下载功能
- 文件存储和路径管理

### 2. 实时通知
- 新作业发布通知
- 成绩发布通知
- 截止时间临近提醒

### 3. 作业历史版本
- 保存作业的多次提交历史
- 查看历史提交记录

### 4. 在线答疑
- 学生向教师提问
- 查看课程公告

### 5. 学习统计
- 学习时长统计
- 作业完成率分析
- 成绩趋势图表

---

## 注意事项

### 1. 权限控制
- 所有学生路由都使用 `@role_required('student')` 装饰器
- 验证学生是否选修课程后才允许访问课程相关内容

### 2. 时间处理
- 截止时间判断使用 `datetime.now()` 与 `assignment.deadline` 比较
- 时间显示使用 `strftime('%Y-%m-%d %H:%M')` 格式化

### 3. 数据完整性
- 查询前检查记录是否存在（使用 `db.session.get()` 或 `first()`）
- 缺失数据显示为 `-`

### 4. 成绩计算
- 成绩由教师端计算并保存到 `Grade` 表
- 学生端仅显示已发布的成绩

---

## 技术实现

### 后端路由（app.py）
```python
@app.route('/student_dashboard')
@login_required
@role_required('student')
def student_dashboard():
    # 实现逻辑...
```

### 模板文件
- `templates/student_dashboard.html` - 学生仪表板
- `templates/student_class_detail.html` - 课程详情
- `templates/student_submit_assignment.html` - 作业提交
- `templates/student_view_grades.html` - 成绩查询

### 样式设计
- 使用内联CSS实现响应式布局
- 统一的配色方案（蓝色主题）
- 图标和表情符号增强视觉效果

---

## 测试建议

1. **功能测试**
   - 测试所有路由的访问权限
   - 测试作业提交和重新提交
   - 测试成绩查询和计算显示

2. **边界测试**
   - 无选课学生的显示
   - 无作业课程的显示
   - 无成绩记录的显示

3. **时间测试**
   - 截止前提交
   - 截止后提交
   - 临近截止时间的提醒

4. **数据验证**
   - 空内容提交
   - 超长文本提交
   - 特殊字符处理
