# 新成绩系统使用指南

## 系统已完成部分

### ✅ 后端 API
所有15个成绩管理API已完成，包括：
- 成绩分类管理（CRUD）
- 成绩项管理（CRUD）
- 成绩录入与批量更新
- 考勤自动计算
- 总评成绩计算（含排名）
- 学生成绩查看
- 成绩统计分析

### ✅ 数据库表
已创建4个新表：
- `grade_categories` - 成绩分类表
- `grade_items` - 成绩项表
- `student_grade_scores` - 学生成绩得分表
- `student_final_grades` - 学生总评成绩表

### ✅ 前端页面
已创建4个新页面：
1. **教师端 - 成绩配置** (`/teacher/class/:id/grade-config`)
2. **教师端 - 成绩录入** (`/teacher/class/:id/grade-item/:itemId`)
3. **教师端 - 成绩统计** (`/teacher/class/:id/grade-statistics`)
4. **学生端 - 我的成绩** (`/my-grades`)

### ✅ 路由配置
所有路由已配置完成，导航栏已更新

---

## 使用流程

### 教师端操作流程

#### 第一步：配置成绩结构
1. 进入教学班详情页 → 成绩管理标签页
2. 点击"成绩配置"按钮
3. 添加成绩分类（如：平时成绩、期中考试、期末考试）
4. 为每个分类设置权重百分比（总和需为100%）
5. 为每个分类添加成绩项：
   - **手动录入**：如"课堂表现"、"期中考试"
   - **关联作业**：自动从作业系统获取分数
   - **考勤自动**：自动计算考勤得分

#### 第二步：录入成绩
1. 在成绩配置页面，找到对应的成绩项
2. 点击"录入成绩"按钮
3. 为每位学生输入得分
4. 保存成绩

#### 第三步：计算考勤（如有考勤项）
1. 找到类型为"考勤自动"的成绩项
2. 点击"计算考勤"按钮
3. 系统自动统计出勤率并计算得分

#### 第四步：计算总评
1. 确保所有分类的权重总和为100%
2. 点击"计算总评成绩"按钮
3. 系统自动计算所有学生的加权平均分和排名

#### 第五步：公开成绩
1. 切换成绩项的"已公开"开关
2. 学生即可在"我的成绩"页面查看

---

### 学生端操作流程

1. 点击导航栏"我的成绩"
2. 选择要查看的课程
3. 查看：
   - 总评成绩和班级排名
   - 各分类得分
   - 各成绩项明细

---

## 配置示例

### 示例1：基础配置（平时+期末）
```
分类1: 平时成绩 (50%)
  ├─ 考勤 (40%) - 类型：考勤自动
  ├─ 作业1 (30%) - 类型：手动录入
  └─ 课堂表现 (30%) - 类型：手动录入

分类2: 期末考试 (50%)
  └─ 期末考试 (100%) - 类型：手动录入
```

### 示例2：详细配置（平时+期中+期末）
```
分类1: 平时成绩 (30%)
  ├─ 考勤 (20%) - 类型：考勤自动
  ├─ 课堂小测 (40%) - 类型：手动录入
  └─ 课后作业 (40%) - 类型：关联作业

分类2: 期中考试 (30%)
  └─ 期中笔试 (100%) - 类型：手动录入

分类3: 期末考试 (40%)
  ├─ 期末笔试 (70%) - 类型：手动录入
  └─ 课程报告 (30%) - 类型：手动录入
```

---

## API 端点速查

### 教师端
- `GET /api/v1/grades/class/{class_id}/categories` - 获取成绩结构
- `POST /api/v1/grades/class/{class_id}/categories` - 创建分类
- `POST /api/v1/grades/categories/{category_id}/items` - 创建成绩项
- `POST /api/v1/grades/items/{item_id}/scores` - 批量录入成绩
- `POST /api/v1/grades/items/{item_id}/calculate-attendance` - 计算考勤
- `POST /api/v1/grades/class/{class_id}/calculate-final` - 计算总评
- `GET /api/v1/grades/class/{class_id}/statistics` - 成绩统计

### 学生端
- `GET /api/v1/grades/student/class/{class_id}/my-grades` - 查看我的成绩

---

## 数据表结构

### grade_categories (成绩分类表)
- `id` - 主键
- `class_id` - 教学班ID
- `name` - 分类名称（如"平时成绩"）
- `weight` - 权重百分比（0-100）
- `description` - 说明

### grade_items (成绩项表)
- `id` - 主键
- `category_id` - 所属分类
- `name` - 成绩项名称
- `type` - 类型（manual/assignment/exam/attendance）
- `weight` - 在分类内的权重
- `max_score` - 满分
- `auto_calculate` - 是否自动计算
- `is_published` - 是否公开

### student_grade_scores (学生成绩表)
- `id` - 主键
- `item_id` - 成绩项ID
- `student_id` - 学生ID
- `score` - 得分

### student_final_grades (总评成绩表)
- `id` - 主键
- `class_id` - 教学班ID
- `student_id` - 学生ID
- `total_score` - 总分
- `rank` - 排名
- `rank_percentage` - 百分位排名
- `category_scores` - 各分类得分（JSON）

---

## 注意事项

1. **权重总和**：所有分类的权重必须为100%才能计算总评
2. **成绩公开**：只有已公开的成绩项，学生才能看到
3. **考勤计算**：考勤成绩项需要手动点击"计算考勤"
4. **总评更新**：修改成绩后需重新点击"计算总评"
5. **排名机制**：总评计算时自动生成班级排名

---

## 前端组件说明

### GradeConfig.vue（成绩配置）
- 功能：配置成绩结构
- 特点：可视化展示分类和成绩项，支持拖拽排序
- 操作：添加/编辑/删除分类和成绩项

### GradeInput.vue（成绩录入）
- 功能：批量录入学生成绩
- 特点：表格形式，支持快速输入
- 自动计算：实时显示百分制得分

### GradeStatistics.vue（成绩统计）
- 功能：查看成绩统计
- 包含：平均分、最高分、最低分、及格率
- 可视化：分数分布图表、排名列表

### MyGrades.vue（我的成绩）
- 功能：学生查看个人成绩
- 展示：总评成绩、排名、各分类详情
- 设计：卡片式布局，彩色进度条

---

## 待优化功能

1. 图表可视化（需引入 ECharts）
2. 成绩导出功能
3. 成绩导入功能
4. 历史成绩对比
5. 成绩分析报告
6. 移动端适配

---

## 问题排查

### 后端问题
- 检查 grades_bp 是否正确注册：`app.py` 中应有 `app.register_blueprint(grades_bp)`
- 检查数据库表是否创建：运行 `python 脚本/migrate_grade_system.py`

### 前端问题
- 检查路由是否配置：查看 `router/index.js`
- 检查API路径：确认baseURL为 `/api/v1`
- 检查导航栏：确认 `App.vue` 中已添加成绩入口

---

## 更新日志

**2026-01-16**
- ✅ 完成成绩系统后端API（15个端点）
- ✅ 创建数据库表（4个表）
- ✅ 完成前端页面（4个页面）
- ✅ 更新路由和导航
- ✅ 数据库迁移成功

---

**系统状态：✅ 可以开始使用**

教师可以立即开始配置成绩结构并录入成绩。
