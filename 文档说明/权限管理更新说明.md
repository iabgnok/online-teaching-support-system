# 管理员权限管理系统 - 更新说明

## 📋 更新内容

### 1. 数据库模型更新
- **Admin表**添加了 `permission_level` 字段（权限级别）
  - 1 = 最高权限（可管理权限）
  - 2 = 中级权限（可管理用户信息）
  - 3 = 一般权限（仅查询功能）
  - 默认值：3

### 2. 权限级别说明

#### 🌟 一级权限（最高）
- ✅ 管理所有管理员权限
- ✅ 管理用户信息（增删改查）
- ✅ 批量数据导入
- ✅ 信息查询

#### ⭐ 二级权限（中级）
- ✅ 管理用户信息（增删改查）
- ✅ 批量数据导入
- ✅ 信息查询
- ❌ 不能管理其他管理员权限

#### ✨ 三级权限（一般）
- ✅ 信息查询
- ❌ 不能管理用户
- ❌ 不能导入数据
- ❌ 不能管理权限

### 3. 新增功能

#### 3.1 权限管理页面
- 路由：`/admin/permissions`
- 需要一级权限
- 可以查看所有管理员及其权限
- 可以修改其他管理员的权限（不能修改自己）

#### 3.2 用户管理筛选
- 按角色筛选（管理员/教师/学生）
- 按状态筛选（激活/禁用）
- 按姓名搜索
- 按用户名搜索

#### 3.3 创建用户时设置权限
- 创建管理员账户时可以选择初始权限级别
- 默认为三级权限

#### 3.4 仪表盘权限控制
- 没有权限的功能显示为灰色
- 提示"需要XX权限"
- 按钮不可点击

### 4. 代码更新

#### 4.1 新增装饰器
```python
@admin_permission_required(level)
```
用于检查管理员是否有足够权限访问特定功能

#### 4.2 更新的路由
- `admin_dashboard` - 传递权限级别
- `admin_user_management` - 需要二级权限，支持筛选
- `admin_permissions` - 新增，需要一级权限

#### 4.3 更新的模板
- `admin_dashboard.html` - 根据权限显示功能
- `admin_user_management.html` - 添加筛选功能
- `admin_create_user.html` - 添加权限选择
- `admin_permissions.html` - 新增权限管理页面

### 5. 数据库迁移

#### 方式一：运行迁移脚本（推荐）
```bash
python migrate_permissions.py
```

#### 方式二：手动SQL（如果脚本失败）
```sql
ALTER TABLE Admin ADD COLUMN permission_level INTEGER DEFAULT 3;
UPDATE Admin SET permission_level = 1 WHERE admin_no = 'A001';
```

### 6. 使用说明

#### 6.1 初次使用
1. 运行迁移脚本更新数据库
2. 系统管理员（admin账户）自动拥有一级权限
3. 其他现有管理员默认为三级权限
4. 可以通过权限管理页面调整

#### 6.2 创建新管理员
1. 进入"创建用户"
2. 选择"管理员"角色
3. 填写基本信息
4. 选择权限级别
5. 提交创建

#### 6.3 修改管理员权限
1. 使用一级权限账户登录
2. 进入"权限管理"
3. 选择要修改的管理员
4. 选择新的权限级别
5. 点击"保存"

### 7. 注意事项

⚠️ **重要提示**
1. 至少保留一个一级权限的管理员
2. 不能修改自己的权限
3. 权限变更立即生效
4. 低权限管理员无法访问高权限功能

### 8. 测试建议

1. 使用admin账户（一级权限）测试所有功能
2. 创建二级权限管理员测试用户管理功能
3. 创建三级权限管理员测试查询功能
4. 确认权限限制正常工作

## 🎉 完成

现在您的系统已经具备完整的管理员权限管理功能！
