{% from "macros.html" import dashboard_nav, unified_styles, page_header %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - åœ¨çº¿æ•™å­¦æ”¯æŒç³»ç»Ÿ</title>
    {{ unified_styles() }}
    <style>
        .exam-fields { display: none; background: #f8f9fa; padding: 15px; margin-top: 10px; border-radius: 8px; border-left: 4px solid #3498db; }
        .required { color: #dc3545; }
    </style>
    <script>
        function toggleExamFields() {
            const type = document.getElementById('type').value;
            const examFields = document.getElementById('exam-fields');
            if (type === 'exam') {
                examFields.style.display = 'block';
            } else {
                examFields.style.display = 'none';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥é¢„è®¾ç±»å‹
        window.onload = function() {
            toggleExamFields();
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="nav-bar">
            <div class="nav-links">
                <a href="{{ url_for('teacher_class_detail', class_id=class_id) }}">â† è¿”å›ç­çº§è¯¦æƒ…</a>
            </div>
            <div class="nav-links">
                <a href="{{ url_for('change_password') }}">ğŸ” ä¿®æ”¹å¯†ç </a>
                <a href="{{ url_for('logout') }}" style="color: #dc3545;">ğŸšº é€€å‡ºç™»å½•</a>
            </div>
        </div>
        
        {{ page_header(title, 'æ•™å­¦ç­ï¼š' + teaching_class.class_name) }}

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="content-section">

        <form method="POST">
            <div class="form-group">
                <label for="type">ç±»å‹ <span class="required">*</span></label>
                <select id="type" name="type" required onchange="toggleExamFields()">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="homework" {% if preset_type == 'homework' %}selected{% endif %}>ä½œä¸š</option>
                    <option value="exam" {% if preset_type == 'exam' %}selected{% endif %}>è€ƒè¯•</option>
                </select>
            </div>

            <div class="form-group">
                <label for="title">æ ‡é¢˜ <span class="required">*</span></label>
                <input type="text" id="title" name="title" required placeholder="å¦‚ï¼šç¬¬ä¸€ç« ä¹ é¢˜">
            </div>

            <div class="form-group">
                <label for="description">è¯´æ˜</label>
                <textarea id="description" name="description" placeholder="ä½œä¸š/è€ƒè¯•çš„è¯¦ç»†è¯´æ˜"></textarea>
            </div>

            <div class="form-group">
                <label for="total_score">æ€»åˆ† <span class="required">*</span></label>
                <input type="number" id="total_score" name="total_score" value="100" min="0" step="0.01" required>
            </div>

            <div class="form-group">
                <label for="deadline">æˆªæ­¢æ—¶é—´ <span class="required">*</span></label>
                <input type="datetime-local" id="deadline" name="deadline" required>
            </div>

            <div id="exam-fields" class="exam-fields">
                <h3>è€ƒè¯•ç‰¹æœ‰è®¾ç½®</h3>
                <div class="form-group">
                    <label for="start_time">è€ƒè¯•å¼€å§‹æ—¶é—´</label>
                    <input type="datetime-local" id="start_time" name="start_time">
                </div>

                <div class="form-group">
                    <label for="duration">è€ƒè¯•æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="duration" name="duration" min="1" placeholder="å¦‚ï¼š120">
                </div>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary">å‘å¸ƒ</button>
                <a href="{{ url_for('teacher_class_detail', class_id=class_id) }}" class="btn btn-secondary">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</body>
</html>
