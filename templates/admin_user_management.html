{% from "macros.html" import dashboard_nav, unified_styles, page_header %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - ç®¡ç†å‘˜ä»ªè¡¨æ¿</title>
    {{ unified_styles() }}
    <style>
        .action-link {
            color: #3498db;
            text-decoration: none;
            margin-right: 10px;
            font-weight: 500;
        }
        .action-link:hover {
            text-decoration: underline;
        }
        .action-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9em;
            margin: 2px;
        }
        .btn-enable {
            background: #27ae60;
            color: white;
        }
        .btn-disable {
            background: #e74c3c;
            color: white;
        }
        .btn-enable:hover {
            background: #229954;
        }
        .btn-disable:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        {{ dashboard_nav('admin') }}
        
        {{ page_header('ğŸ‘¥ ç”¨æˆ·ç®¡ç†', '') }}
        
        <div class="content-section">
            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h3>{{ admin_count }}</h3>
                    <p>ç®¡ç†å‘˜æ€»æ•°</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>{{ teacher_count }}</h3>
                    <p>æ•™å¸ˆæ€»æ•°</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3>{{ student_count }}</h3>
                    <p>å­¦ç”Ÿæ€»æ•°</p>
                </div>
            </div>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="content-section">
            <h3 class="section-title">ğŸ” ç­›é€‰æ¡ä»¶</h3>
            <form method="GET" action="{{ url_for('admin_user_management') }}">
                <div class="form-grid">
                    <div class="form-group">
                        <label>è§’è‰²</label>
                        <select name="role">
                            <option value="">å…¨éƒ¨è§’è‰²</option>
                            <option value="admin" {% if role_filter == 'admin' %}selected{% endif %}>ç®¡ç†å‘˜</option>
                            <option value="teacher" {% if role_filter == 'teacher' %}selected{% endif %}>æ•™å¸ˆ</option>
                            <option value="student" {% if role_filter == 'student' %}selected{% endif %}>å­¦ç”Ÿ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>çŠ¶æ€</label>
                        <select name="status">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="1" {% if status_filter == '1' %}selected{% endif %}>æ¿€æ´»</option>
                            <option value="0" {% if status_filter == '0' %}selected{% endif %}>ç¦ç”¨</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>å§“å</label>
                        <input type="text" name="search_name" value="{{ search_name }}" placeholder="è¾“å…¥å§“åæœç´¢">
                    </div>
                    
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" name="search_username" value="{{ search_username }}" placeholder="è¾“å…¥ç”¨æˆ·åæœç´¢">
                    </div>
                    
                    <div class="form-group" style="display: flex; align-items: flex-end; gap: 10px;">
                        <button type="submit" class="btn btn-primary">ğŸ” ç­›é€‰</button>
                        <a href="{{ url_for('admin_user_management') }}" class="btn btn-secondary">ğŸ”„ é‡ç½®</a>
                    </div>
                </div>
            </form>
        </div>

        <!-- ç”¨æˆ·åˆ—è¡¨ -->
        <div class="content-section">
            <h2 style="margin-top: 0; color: #2c3e50;">ç³»ç»Ÿç”¨æˆ·åˆ—è¡¨ (å…± {{ users|length }} äºº)</h2>
            <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ç”¨æˆ·å</th>
                        <th>çœŸå®å§“å</th>
                        <th>è§’è‰²</th>
                        <th>æ‰‹æœºå·</th>
                        <th>é‚®ç®±</th>
                        <th>çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.user_id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.real_name }}</td>
                        <td>
                            {% if user.role == 'admin' %}
                                ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜
                            {% elif user.role == 'teacher' %}
                                ğŸ‘¨â€ğŸ« æ•™å¸ˆ
                            {% elif user.role == 'student' %}
                                ğŸ“ å­¦ç”Ÿ
                            {% endif %}
                        </td>
                        <td>{{ user.phone or '-' }}</td>
                        <td>{{ user.email or '-' }}</td>
                        <td>
                            {% if user.status == 1 %}
                                <span class="status-active">âœ“ æ¿€æ´»</span>
                            {% else %}
                                <span class="status-inactive">âœ— ç¦ç”¨</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('admin_edit_user', user_id=user.user_id) }}" class="action-link">âœï¸ ç¼–è¾‘</a>
                            <form method="POST" action="{{ url_for('admin_toggle_status', user_id=user.user_id) }}" style="display:inline;">
                                <button type="submit" class="action-btn {% if user.status == 1 %}btn-disable{% else %}btn-enable{% endif %}"
                                    {% if user.user_id == current_user.user_id %} disabled title="ä¸èƒ½ç¦ç”¨è‡ªå·±" {% endif %}>
                                    {% if user.status == 1 %}ğŸš« ç¦ç”¨{% else %}âœ“ æ¿€æ´»{% endif %}
                                </button>
                            </form>
                            {% if user.user_id != current_user.user_id %}
                            <form method="POST" action="{{ url_for('admin_delete_user', user_id=user.user_id) }}" style="display:inline;" 
                                  onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤ç”¨æˆ·ã€Œ{{ user.real_name }}ã€å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼');">
                                <button type="submit" class="action-btn" style="background: #e74c3c; color: white;">ğŸ—‘ï¸ åˆ é™¤</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
    </div>
</body>
</html>