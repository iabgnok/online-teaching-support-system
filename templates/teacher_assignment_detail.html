{% from "macros.html" import dashboard_nav, unified_styles, page_header %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - åœ¨çº¿æ•™å­¦æ”¯æŒç³»ç»Ÿ</title>
    {{ unified_styles() }}
</head>
<body>
    <div class="container">
        <div class="nav-bar">
            <div class="nav-links">
                <a href="{{ url_for('teacher_class_detail', class_id=assignment.class_id) }}">â† è¿”å›ç­çº§è¯¦æƒ…</a>
            </div>
            <div class="nav-links">
                <a href="{{ url_for('change_password') }}">ğŸ” ä¿®æ”¹å¯†ç </a>
                <a href="{{ url_for('logout') }}" style="color: #dc3545;">ğŸšº é€€å‡ºç™»å½•</a>
            </div>
        </div>
        
        {{ page_header(assignment.title, ('ç±»å‹ï¼š' + ('ä½œä¸š' if assignment.type == 'homework' else 'è€ƒè¯•') + ' | æ€»åˆ†ï¼š' + assignment.total_score|string + ' | æˆªæ­¢æ—¶é—´ï¼š' + assignment.deadline.strftime('%Y-%m-%d %H:%M'))) }}

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="content-section">
            <div class="stats-grid">
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <p style="margin: 0;">æ€»å­¦ç”Ÿæ•°</p>
                <h3 style="margin: 10px 0 0 0; font-size: 2em;">{{ total_students }}</h3>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <p style="margin: 0;">å·²æäº¤</p>
                <h3 style="margin: 10px 0 0 0; font-size: 2em;">{{ submitted_count }}</h3>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <p style="margin: 0;">å·²æ‰¹æ”¹</p>
                <h3 style="margin: 10px 0 0 0; font-size: 2em;">{{ graded_count }}</h3>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                <p style="margin: 0;">æœªæäº¤</p>
                <h3 style="margin: 10px 0 0 0; font-size: 2em;">{{ unsubmitted_count }}</h3>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <p style="margin: 0;">æäº¤ç‡</p>
                <h3 style="margin: 10px 0 0 0; font-size: 2em;">{{ submission_rate }}%</h3>
            </div>
        </div>
        </div>

        <div class="content-section">
            <h2 class="section-title">ğŸ“‹ å­¦ç”Ÿæäº¤æƒ…å†µ</h2>
            <div style="overflow-x: auto;">
            <table>
            <thead>
                <tr>
                    <th>å­¦å·</th>
                    <th>å§“å</th>
                    <th>æäº¤çŠ¶æ€</th>
                    <th>æäº¤æ—¶é—´</th>
                    <th>é™„ä»¶</th>
                    <th>å¾—åˆ†</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for item in submission_list %}
                <tr>
                    <td>{{ item.student.student_no }}</td>
                    <td>{{ item.student.name }}</td>
                    <td>
                        <span class="status-{{ 'graded' if item.submission and item.submission.status == 'graded' else ('submitted' if item.submission else 'notsubmit') }}">
                            {{ item.status }}
                        </span>
                    </td>
                    <td>{{ item.submission.submit_time.strftime('%Y-%m-%d %H:%M') if item.submission else '-' }}</td>
                    <td>
                        {% if item.submission and item.submission.file_name %}
                            <a href="{{ url_for('download_submission_file', submission_id=item.submission.submission_id) }}" class="btn btn-success" style="padding: 4px 8px; font-size: 0.9em;">ğŸ“¥ ä¸‹è½½</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ item.submission.score if item.submission and item.submission.score is not none else '-' }}</td>
                    <td>
                        {% if item.submission %}
                            <a href="{{ url_for('teacher_grade_submission', submission_id=item.submission.submission_id) }}" class="btn btn-primary">
                                {{ 'é‡æ–°æ‰¹æ”¹' if item.submission.status == 'graded' else 'æ‰¹æ”¹' }}
                            </a>
                        {% else %}
                            <span style="color: #999;">æœªæäº¤</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
        </div>
    </div>
</body>
</html>
