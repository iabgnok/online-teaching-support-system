{% from "macros.html" import dashboard_nav, unified_styles, page_header %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æ–°å»ºè€ƒå‹¤ - {{ teaching_class.course.course_name }}</title>
    {{ unified_styles() }}
    <style>
        .student-row {
            transition: background 0.2s;
        }
        .student-row:hover {
            background: #f8f9fa;
        }
        .radio-group label {
            margin-right: 15px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        /* Radio Button Styles */
        input[type="radio"] { display: none; }
        
        input[value="present"]:checked + label { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        input[value="absent"]:checked + label { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        input[value="late"]:checked + label { background: #fff3cd; color: #856404; border-color: #ffeeba; }
        input[value="leave"]:checked + label { background: #d1ecf1; color: #0c5460; border-color: #bee5eb; }
        
        .status-label {
            display: inline-block;
            width: 60px;
            text-align: center;
        }
    </style>
    <script>
        function setAll(status) {
            const radios = document.querySelectorAll(`input[value="${status}"]`);
            radios.forEach(radio => {
                radio.checked = true;
            });
        }
    </script>
</head>
<body>
    <div class="container">
        {{ dashboard_nav('teacher') }}
        
        <div class="header">
            <a href="{{ url_for('teacher_attendance_list', class_id=teaching_class.class_id) }}" style="text-decoration: none; color: #3498db; font-size: 0.9em;">&larr; è¿”å›è€ƒå‹¤åˆ—è¡¨</a>
            <h1>â• æ–°å»ºè€ƒå‹¤ - {{ teaching_class.class_name }}</h1>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="POST" class="content-section">
            <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee;">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: bold; margin-right: 15px;">ğŸ“ è€ƒå‹¤æ¨¡å¼ï¼š</label>
                    <label style="margin-right: 15px;">
                        <input type="radio" name="mode" value="manual" checked onchange="toggleMode()" style="display:inline;"> æ‰‹åŠ¨ç‚¹å
                    </label>
                    <label>
                        <input type="radio" name="mode" value="self" onchange="toggleMode()" style="display:inline;"> å­¦ç”Ÿè‡ªç­¾ (æ‰«ç /ç‚¹å‡»)
                    </label>
                </div>
                
                <label style="font-weight: bold; margin-right: 10px;">ğŸ“… è€ƒå‹¤æ—¥æœŸï¼š</label>
                <input type="date" name="date" value="{{ today }}" required style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                
                <!-- Manual Mode Controls -->
                <div id="manual-controls" style="float: right;">
                    <span style="color: #666; margin-right: 10px; font-size: 0.9em;">æ‰¹é‡æ“ä½œï¼š</span>
                    <button type="button" onclick="setAll('present')" class="btn btn-mini btn-success">å…¨å‘˜å‡ºå‹¤</button>
                    <button type="button" onclick="setAll('absent')" class="btn btn-mini btn-danger">å…¨å‘˜ç¼ºå¸­</button>
                </div>

                <!-- Self Mode Controls -->
                <div id="self-controls" style="display: none; margin-top: 15px; background: #e8f5e9; padding: 15px; border-radius: 5px;">
                    <div style="margin-bottom: 10px;">
                        <label style="font-weight: bold;">â³ æ­£å¸¸ç­¾åˆ°æ—¶é•¿ (åˆ†é’Ÿ): </label>
                        <input type="number" name="normal_minutes" value="10" min="1" max="120" style="width: 60px; padding: 5px;">
                        <span style="color: #666; font-size: 0.9em;">(åœ¨æ­¤æ—¶é—´å†…ç­¾åˆ°è®°ä¸º"å‡ºå‹¤")</span>
                    </div>
                    <div>
                        <label style="font-weight: bold;">ğŸš« è¿Ÿåˆ°å®¹å¿æ—¶é•¿ (åˆ†é’Ÿ): </label>
                        <input type="number" name="late_minutes" value="20" min="0" max="120" style="width: 60px; padding: 5px;">
                        <span style="color: #666; font-size: 0.9em;">(è¶…è¿‡æ­£å¸¸æ—¶é•¿ä½†åœ¨æ­¤æ—¶é—´å†…è®°ä¸º"è¿Ÿåˆ°"ï¼Œä¹‹åæ— æ³•ç­¾åˆ°)</span>
                    </div>
                </div>
            </div>

            <table id="student-table">
                <thead>
                    <tr>
                        <th style="width: 15%">å­¦å·</th>
                        <th style="width: 15%">å§“å</th>
                        <th style="width: 40%">çŠ¶æ€</th>
                        <th>å¤‡æ³¨</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr class="student-row">
                        <td>{{ student.student_no }}</td>
                        <td>{{ student.name }}</td>
                        <td class="radio-group">
                            <input type="radio" name="status_{{ student.student_id }}" id="p_{{ student.student_id }}" value="present" checked>
                            <label for="p_{{ student.student_id }}" class="status-label">å‡ºå‹¤</label>
                            
                            <input type="radio" name="status_{{ student.student_id }}" id="a_{{ student.student_id }}" value="absent">
                            <label for="a_{{ student.student_id }}" class="status-label">ç¼ºå¸­</label>
                            
                            <input type="radio" name="status_{{ student.student_id }}" id="l_{{ student.student_id }}" value="late">
                            <label for="l_{{ student.student_id }}" class="status-label">è¿Ÿåˆ°</label>
                            
                            <input type="radio" name="status_{{ student.student_id }}" id="v_{{ student.student_id }}" value="leave">
                            <label for="v_{{ student.student_id }}" class="status-label">è¯·å‡</label>
                        </td>
                        <td>
                            <input type="text" name="remarks_{{ student.student_id }}" placeholder="å¤‡æ³¨..." style="width: 100%; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div id="self-mode-message" style="display: none; padding: 40px; text-align: center; color: #666;">
                <h3>ğŸ“¡ å­¦ç”Ÿè‡ªç­¾æ¨¡å¼</h3>
                <p>æäº¤åå°†è‡ªåŠ¨åˆ›å»ºç­¾åˆ°æ´»åŠ¨ï¼Œæ‰€æœ‰å­¦ç”Ÿé»˜è®¤ä¸º"ç¼ºå¸­"çŠ¶æ€ã€‚</p>
                <p>å­¦ç”Ÿéœ€åœ¨è§„å®šæ—¶é—´å†…ç™»å½•ç³»ç»Ÿç‚¹å‡»"ç­¾åˆ°"æŒ‰é’®ã€‚</p>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <button type="submit" class="btn btn-primary" style="padding: 12px 40px; font-size: 1.1em;">å‘èµ·è€ƒå‹¤</button>
            </div>
        </form>
    </div>
    <script>
        function toggleMode() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const manualControls = document.getElementById('manual-controls');
            const selfControls = document.getElementById('self-controls');
            const studentTable = document.getElementById('student-table');
            const selfMessage = document.getElementById('self-mode-message');
            
            if (mode === 'manual') {
                manualControls.style.display = 'block';
                selfControls.style.display = 'none';
                studentTable.style.display = 'table';
                selfMessage.style.display = 'none';
            } else {
                manualControls.style.display = 'none';
                selfControls.style.display = 'block';
                studentTable.style.display = 'none';
                selfMessage.style.display = 'block';
            }
        }
    </script>
</body>
</html>