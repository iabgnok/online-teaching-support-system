{% from "macros.html" import dashboard_nav, unified_styles, page_header %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>è€ƒå‹¤è®°å½•åˆ—è¡¨ - {{ teaching_class.course.course_name }}</title>
    {{ unified_styles() }}
    <style>
        .rate-high { color: #28a745; font-weight: bold; }
        .rate-mid { color: #ffc107; font-weight: bold; }
        .rate-low { color: #dc3545; font-weight: bold; }
        
        .stat-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-right: 5px;
            background: #eee;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        {{ dashboard_nav('teacher') }}
        
        <div class="header" style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <a href="{{ url_for('teacher_class_detail', class_id=teaching_class.class_id) }}" style="text-decoration: none; color: #3498db; font-size: 0.9em;">&larr; è¿”å›ç­çº§è¯¦æƒ…</a>
                    <h1>ğŸ“… è€ƒå‹¤ç®¡ç† - {{ teaching_class.class_name }}</h1>
                </div>
                <div>
                    <a href="{{ url_for('teacher_create_attendance', class_id=teaching_class.class_id) }}" class="btn btn-primary">â• æ–°å»ºè€ƒå‹¤</a>
                </div>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="content-section">
            {% if attendances %}
            <table>
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>å‡ºå‹¤ç‡</th>
                        <th>ç»Ÿè®¡è¯¦æƒ…</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for att in attendances %}
                    <tr>
                        <td style="font-weight: bold;">{{ att.date.strftime('%Y-%m-%d') }}</td>
                        <td>
                            {% if att.attendance_rate >= 90 %}
                                <span class="rate-high">{{ att.attendance_rate }}%</span>
                            {% elif att.attendance_rate >= 70 %}
                                <span class="rate-mid">{{ att.attendance_rate }}%</span>
                            {% else %}
                                <span class="rate-low">{{ att.attendance_rate }}%</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="stat-badge" style="background:#e8f5e9; color:#2e7d32">å®åˆ°: {{ att.present_count }}</span>
                            <span class="stat-badge" style="background:#ffebee; color:#c62828">ç¼ºå¸­: {{ att.absent_count }}</span>
                            <span class="stat-badge" style="background:#fff3e0; color:#ef6c00">è¿Ÿåˆ°: {{ att.late_count }}</span>
                            <span class="stat-badge" style="background:#e3f2fd; color:#1565c0">è¯·å‡: {{ att.leave_count }}</span>
                        </td>
                        <td>{{ att.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <a href="{{ url_for('teacher_attendance_detail', class_id=teaching_class.class_id, attendance_id=att.id) }}" class="btn btn-mini btn-primary">æŸ¥çœ‹è¯¦æƒ…</a>
                            <form action="{{ url_for('teacher_delete_attendance', class_id=teaching_class.class_id, attendance_id=att.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è€ƒå‹¤è®°å½•å—ï¼Ÿ');">
                                <button type="submit" class="btn btn-mini btn-danger">åˆ é™¤</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div style="text-align: center; padding: 40px; color: #999;">
                <p>æš‚æ— è€ƒå‹¤è®°å½•ï¼Œç‚¹å‡»å³ä¸Šè§’"æ–°å»ºè€ƒå‹¤"å¼€å§‹è®°å½•ã€‚</p>
            </div>
            {% endif %}
        </div>
    </div>
</body>
</html>