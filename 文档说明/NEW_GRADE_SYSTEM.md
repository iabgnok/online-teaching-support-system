# 新成绩系统使用说明

## 📊 系统设计概述

### 核心架构
```
成绩系统
├── 成绩分类 (GradeCategory)
│   ├── 平时成绩 (20%)
│   ├── 作业成绩 (30%)
│   └── 考试成绩 (50%)
├── 成绩项 (GradeItem)
│   ├── 考勤 (自动计算)
│   ├── 课堂表现 (手动录入)
│   ├── 作业1-N (关联Assignment)
│   └── 期中/期末考试
├── 学生成绩 (StudentGradeScore)
│   └── 每个学生在每个成绩项的得分
└── 总评成绩 (StudentFinalGrade)
    ├── 总分
    ├── 排名
    └── 百分位
```

## 🎯 主要特性

### 1. 灵活的成绩分类
- 教师可自定义成绩分类（如：平时、作业、考试）
- 每个分类可设置权重（总和应为100%）
- 支持分类排序

### 2. 自定义成绩项
- **手动录入项** (manual)：教师直接输入分数
- **作业关联项** (assignment)：自动从作业提交中获取
- **考试关联项** (exam)：关联考试成绩
- **考勤自动项** (attendance)：自动计算考勤得分

### 3. 考勤自动计入成绩
- 出勤：1.0分
- 迟到：0.8分
- 缺勤：0分
- 请假：可配置
- 自动转换为百分制

### 4. 排名系统
- 自动计算班级排名
- 显示百分位（前XX%）
- 支持并列排名

### 5. 成绩统计
- 平均分、最高分、最低分
- 及格率、优秀率
- 分数段分布
- 支持图表展示

## 📡 API接口说明

### 成绩分类管理

#### 获取成绩分类
```
GET /api/v1/grades/class/{class_id}/categories
```

#### 创建成绩分类
```
POST /api/v1/grades/class/{class_id}/categories
Body: {
  "name": "平时成绩",
  "weight": 20,
  "description": "包括考勤和课堂表现",
  "order": 1
}
```

#### 更新成绩分类
```
PUT /api/v1/grades/categories/{category_id}
Body: {
  "name": "平时成绩",
  "weight": 25
}
```

#### 删除成绩分类
```
DELETE /api/v1/grades/categories/{category_id}
```

### 成绩项管理

#### 创建成绩项
```
POST /api/v1/grades/categories/{category_id}/items
Body: {
  "name": "考勤",
  "type": "attendance",
  "weight": 50,
  "max_score": 100,
  "auto_calculate": true,
  "is_published": false
}
```

#### 更新成绩项
```
PUT /api/v1/grades/items/{item_id}
Body: {
  "name": "考勤分",
  "is_published": true
}
```

#### 删除成绩项
```
DELETE /api/v1/grades/items/{item_id}
```

### 成绩录入

#### 获取成绩项的所有学生得分
```
GET /api/v1/grades/items/{item_id}/scores
```

#### 批量更新成绩
```
POST /api/v1/grades/items/{item_id}/scores
Body: {
  "scores": [
    {"student_id": 123, "score": 85},
    {"student_id": 124, "score": 90}
  ]
}
```

#### 自动计算考勤成绩
```
POST /api/v1/grades/items/{item_id}/calculate-attendance
```

### 总评成绩

#### 计算总评成绩和排名
```
POST /api/v1/grades/class/{class_id}/calculate-final
```

#### 学生查看自己的成绩
```
GET /api/v1/grades/student/class/{class_id}/my-grades
```

#### 获取成绩统计
```
GET /api/v1/grades/class/{class_id}/statistics
```

## 🔄 使用流程

### 教师端流程

1. **配置成绩结构**
   ```
   创建分类：平时成绩(20%)、作业(30%)、考试(50%)
   └─> 添加成绩项
       ├─ 平时成绩：考勤(60%)、课堂表现(40%)
       ├─ 作业：作业1-5
       └─ 考试：期中(40%)、期末(60%)
   ```

2. **录入成绩**
   ```
   - 考勤：点击"自动计算"
   - 课堂表现：批量录入
   - 作业：从作业批改自动获取
   - 考试：手动录入
   ```

3. **计算总评**
   ```
   点击"计算总评成绩" → 自动计算并排名
   ```

4. **公开成绩**
   ```
   设置成绩项/总评为"已公开"状态
   ```

5. **查看统计**
   ```
   查看成绩分布、及格率等统计信息
   ```

### 学生端流程

1. **查看成绩明细**
   ```
   查看各个成绩项的得分
   ```

2. **查看总评成绩**
   ```
   - 总分
   - 班级排名
   - 各分类得分
   ```

## 🎨 前端页面设计建议

### 教师端页面

#### 1. 成绩配置页面
```
成绩结构配置
├── 分类管理
│   ├── [+ 添加分类]
│   ├── 平时成绩 (20%) [编辑] [删除]
│   │   ├── [+ 添加成绩项]
│   │   ├── 考勤 (自动) [计算] [公开]
│   │   └── 课堂表现 [录入]
│   ├── 作业 (30%)
│   └── 考试 (50%)
└── [保存配置]
```

#### 2. 成绩录入页面
```
成绩录入 - 考勤
┌────────────────────────────────┐
│ 学号     │ 姓名   │ 得分 │ 备注 │
├────────────────────────────────┤
│ 2023001  │ 张三   │ 95   │      │
│ 2023002  │ 李四   │ 88   │      │
└────────────────────────────────┘
[批量导入] [保存] [自动计算]
```

#### 3. 成绩统计页面
```
成绩统计
├── 基本信息
│   ├── 平均分: 82.5
│   ├── 及格率: 95%
│   └── 优秀率: 30%
├── 分数分布柱状图
└── 排名列表
```

### 学生端页面

#### 我的成绩页面
```
操作系统2025秋01班 - 我的成绩
┌─────────────────────────────┐
│ 总评成绩                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│   85.5 分                     │
│   班级排名: 5 / 50 (前10%)    │
└─────────────────────────────┘

成绩明细
├── 平时成绩 (20%)  ━━━━━━ 90分
│   ├── 考勤 (60%): 95分
│   └── 课堂表现 (40%): 85分
├── 作业 (30%)      ━━━━━━ 82分
│   ├── 作业1: 85分
│   ├── 作业2: 80分
│   └── ...
└── 考试 (50%)      ━━━━━━ 85分
    ├── 期中 (40%): 82分
    └── 期末 (60%): 87分
```

## 💡 使用示例

### 示例1：配置成绩结构
```javascript
// 1. 创建分类
await api.post('/grades/class/101/categories', {
  name: '平时成绩',
  weight: 20,
  order: 1
});

// 2. 添加考勤项
await api.post('/grades/categories/1/items', {
  name: '考勤',
  type: 'attendance',
  weight: 60,
  auto_calculate: true
});

// 3. 自动计算考勤
await api.post('/grades/items/1/calculate-attendance');
```

### 示例2：批量录入成绩
```javascript
await api.post('/grades/items/2/scores', {
  scores: [
    { student_id: 123, score: 85 },
    { student_id: 124, score: 90 },
    { student_id: 125, score: 78 }
  ]
});
```

### 示例3：计算总评
```javascript
await api.post('/grades/class/101/calculate-final');
```

## 🔧 数据库迁移

需要创建新表：
- `GradeCategory` - 成绩分类
- `GradeItem` - 成绩项
- `StudentGradeScore` - 学生成绩明细
- `StudentFinalGrade` - 学生总评成绩

## ⚠️ 注意事项

1. **权重检查**：确保分类权重总和为100%
2. **成绩公开**：只有设置为公开的成绩学生才能看到
3. **考勤计算**：需要先有考勤记录才能计算考勤成绩
4. **排名更新**：修改成绩后需重新计算总评才能更新排名
5. **数据备份**：成绩数据重要，建议定期备份

## 🚀 后续扩展

- [ ] 成绩导入导出（Excel）
- [ ] 成绩修改日志
- [ ] 成绩申诉功能
- [ ] 历史成绩查询
- [ ] 成绩趋势分析
- [ ] 学分绩点计算
