{% from "macros.html" import dashboard_nav, unified_styles, page_header %}
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - åœ¨çº¿æ•™å­¦æ”¯æŒç³»ç»Ÿ</title>
    {{ unified_styles() }}
    <style>
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            box-sizing: border-box;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            resize: vertical;
        }
        textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        input[type="file"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        .required { color: #dc3545; }
        .deadline-warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .deadline-passed { background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .existing-submission { background: #e7f3ff; border-left: 4px solid #007bff; padding: 15px; margin: 15px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        {{ dashboard_nav('student') }}
        
        {{ page_header('ğŸ“ æäº¤' + ('ä½œä¸š' if assignment.type == 'homework' else 'è€ƒè¯•'), '') }}

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="info-card">
            <h3>è¯¾ç¨‹ä¿¡æ¯</h3>
            <p><strong>è¯¾ç¨‹åç§°ï¼š</strong>{{ course.course_name }}</p>
            <p><strong>{{ 'ä½œä¸š' if assignment.type == 'homework' else 'è€ƒè¯•' }}æ ‡é¢˜ï¼š</strong>{{ assignment.title }}</p>
            <p><strong>æ€»åˆ†ï¼š</strong>{{ assignment.total_score }}</p>
            <p><strong>æˆªæ­¢æ—¶é—´ï¼š</strong>{{ assignment.deadline.strftime('%Y-%m-%d %H:%M') }}</p>
            {% if assignment.description %}
            <p><strong>è¯´æ˜ï¼š</strong></p>
            <p style="white-space: pre-wrap; background: white; padding: 10px; border-radius: 4px;">{{ assignment.description }}</p>
            {% endif %}
        </div>

        {% set now = [] %}
        {% if now.__class__.__name__ == 'list' %}
            {% set _ = now.append(1) %}
        {% endif %}
        
        {% if assignment.deadline < assignment.deadline.__class__.now() %}
        <div class="deadline-passed">
            <strong>âš ï¸ æ³¨æ„ï¼š</strong>å·²è¶…è¿‡æˆªæ­¢æ—¶é—´ï¼Œæäº¤å¯èƒ½ä¸è¢«æ¥å—æˆ–ä¼šè¢«æ‰£åˆ†ã€‚
        </div>
        {% elif (assignment.deadline - assignment.deadline.__class__.now()).total_seconds() < 86400 %}
        <div class="deadline-warning">
            <strong>â° æé†’ï¼š</strong>è·ç¦»æˆªæ­¢æ—¶é—´ä¸è¶³24å°æ—¶ï¼Œè¯·å°½å¿«æäº¤ï¼
        </div>
        {% endif %}

        {% if existing_submission %}
        <div class="existing-submission">
            <h4>ğŸ“‹ å·²æœ‰æäº¤è®°å½•</h4>
            <p><strong>æäº¤æ—¶é—´ï¼š</strong>{{ existing_submission.submit_time.strftime('%Y-%m-%d %H:%M') }}</p>
            <p><strong>çŠ¶æ€ï¼š</strong>{{ 'å·²æ‰¹æ”¹' if existing_submission.status == 'graded' else 'å·²æäº¤' }}</p>
            {% if existing_submission.status == 'graded' %}
            <p><strong>å¾—åˆ†ï¼š</strong><span style="font-size: 1.2em; color: #28a745;">{{ existing_submission.score }}</span></p>
            {% if existing_submission.feedback %}
            <p><strong>æ•™å¸ˆåé¦ˆï¼š</strong></p>
            <p style="background: white; padding: 10px; border-radius: 4px;">{{ existing_submission.feedback }}</p>
            {% endif %}
            {% endif %}
            <p style="color: #666; font-size: 0.9em;">æäº¤æ–°å†…å®¹å°†è¦†ç›–ä¹‹å‰çš„æäº¤</p>
        </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="content">æäº¤å†…å®¹ <span class="required">*</span></label>
                <textarea id="content" name="content" placeholder="è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆæˆ–è¯´æ˜...">{% if existing_submission %}{{ existing_submission.content }}{% endif %}</textarea>
            </div>

            <div class="form-group">
                <label for="file">ä¸Šä¼ æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰</label>
                <input type="file" id="file" name="file">
                <small style="color: #666;">æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼šPDF, Word, Excel, PPT, TXT, ZIP, RAR, å›¾ç‰‡ç­‰ï¼ˆæœ€å¤§100MBï¼‰</small>
                {% if existing_submission and existing_submission.file_name %}
                <p style="margin-top: 10px; background: #e7f3ff; padding: 8px; border-radius: 4px;">
                    <strong>å·²ä¸Šä¼ æ–‡ä»¶ï¼š</strong>{{ existing_submission.file_name }}
                    <a href="{{ url_for('download_submission_file', submission_id=existing_submission.submission_id) }}" style="margin-left: 10px; color: #007bff;">ğŸ“¥ ä¸‹è½½</a>
                </p>
                {% endif %}
            </div>

            <div style="margin-top: 30px;">
                <button type="submit" class="btn btn-primary">{{ 'é‡æ–°æäº¤' if existing_submission else 'æäº¤' }}</button>
                <a href="{{ url_for('student_class_detail', class_id=assignment.class_id) }}" class="btn btn-secondary">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</body>
</html>
